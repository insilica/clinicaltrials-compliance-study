schema: '2.0'
stages:
  download-20170105:
    cmd: stages/01_download_db_20170105.sh
    deps:
    - path: stages/01_download_db_20170105.sh
      hash: md5
      md5: 6369e51a35200af74e8359122d1afa11
      size: 500
    outs:
    - path: download/aact/db-dump/20170105_clinical_trials.zip
      hash: md5
      md5: 54550221d6d2f728b5df64ea40078b2b
      size: 639987071
  download-20240430:
    cmd: stages/01_download_db_20240430.sh
    deps:
    - path: stages/01_download_db_20240430.sh
      hash: md5
      md5: 0f380d067cb2eeab31c97253811e9fb5
      size: 412
    outs:
    - path: download/aact/db-dump/20240430_clinical_trials.zip
      hash: md5
      md5: dd7dd067786f58bbd6cd43758fc1a3da
      size: 1831128430
  download-paper-data:
    cmd: stages/01_download_paper_data.sh
    deps:
    - path: stages/01_download_paper_data.sh
      hash: md5
      md5: 9cbfcb140a15b9b54101639dff6653e0
      size: 524
    outs:
    - path: download/anderson2015
      hash: md5
      md5: 0f627e15c08e5ec23c2eabe0ad574d25.dir
      size: 4199399
      nfiles: 2
  build-paper-data:
    cmd: stages/02_build-anderson2015.sh
    deps:
    - path: download/anderson2015
      hash: md5
      md5: 0f627e15c08e5ec23c2eabe0ad574d25.dir
      size: 4199399
      nfiles: 2
    - path: stages/02_build-anderson2015.sh
      hash: md5
      md5: 0942894b0d5b0d180db7a7deecc38f64
      size: 464
    - path: stages/csv2parquet.py
      hash: md5
      md5: 7ad66f7287f06705bbbd11fd0791ad63
      size: 1260
    outs:
    - path: brick/anderson2015
      hash: md5
      md5: 1395cc31b50eca34bf0a57f5a4ed9d0f.dir
      size: 1387361
      nfiles: 4
  download-cthist-json:
    cmd: stages/01_download_cthist_json.sh
    deps:
    - path: brick/anderson2015
      hash: md5
      md5: 1395cc31b50eca34bf0a57f5a4ed9d0f.dir
      size: 1387361
      nfiles: 4
    - path: download/aact/db-dump/20240430_clinical_trials.zip
      hash: md5
      md5: dd7dd067786f58bbd6cd43758fc1a3da
      size: 1831128430
    - path: stages/01_download_cthist_json.sh
      hash: md5
      md5: 77aad131be4444d3d01bccb4527bb04b
      size: 952
    - path: stages/fetch-cthist-json.pl
      hash: md5
      md5: e9cc9af2851ee15b912f6658d4d38752
      size: 12768
    outs:
    - path: download/ctgov/historical
      hash: md5
      md5: e040593bab918704633877b9b5c89197.dir
      size: 72594385446
      nfiles: 492953
  build-ctgov-studies-all@anderson2015_2008-2012:
    cmd:
    - mkdir -p $(dirname brick/analysis-20130927/ctgov-studies-all.parquet)
    - script/tt-render-by-param anderson2015_2008-2012 sql/create_cthist_all.sql |
      duckdb
    deps:
    - path: download/ctgov/historical
      hash: md5
      md5: e040593bab918704633877b9b5c89197.dir
      size: 72594385446
      nfiles: 492953
    - path: sql/create_cthist_all.sql
      hash: md5
      md5: 8b2473c013948c766a2e1978c15ac12c
      size: 8314
    outs:
    - path: brick/analysis-20130927/ctgov-studies-all.parquet
      hash: md5
      md5: b962b712813c1defae93f0fd84f2091d
      size: 6240275
  build-ctgov-studies-all@stanford_2019-2023:
    cmd:
    - mkdir -p $(dirname brick/analysis-20240430/ctgov-studies-all.parquet)
    - script/tt-render-by-param stanford_2019-2023 sql/create_cthist_all.sql | duckdb
    deps:
    - path: download/ctgov/historical
      hash: md5
      md5: e040593bab918704633877b9b5c89197.dir
      size: 72594385446
      nfiles: 492953
    - path: sql/create_cthist_all.sql
      hash: md5
      md5: 8b2473c013948c766a2e1978c15ac12c
      size: 8314
    outs:
    - path: brick/analysis-20240430/ctgov-studies-all.parquet
      hash: md5
      md5: 6da0dbb52abb77e9552b0a0085a9e93f
      size: 22499510
  build-ctgov-studies-hlact-filtered@anderson2015_2008-2012:
    cmd:
    - make docker-compose-up
    - mkdir -p $(dirname brick/analysis-20130927/ctgov-studies-hlact.parquet)
    - . .env; script/tt-render-by-param anderson2015_2008-2012 sql/create_cthist_hlact.sql
      | duckdb
    deps:
    - path: brick/analysis-20130927/ctgov-studies-all.parquet
      hash: md5
      md5: b962b712813c1defae93f0fd84f2091d
      size: 6240275
    - path: download/aact/db-dump/20240430_clinical_trials.zip
      hash: md5
      md5: dd7dd067786f58bbd6cd43758fc1a3da
      size: 1831128430
    - path: sql/create_cthist_hlact.sql
      hash: md5
      md5: a6a598b2d9b875dfd0abd5aae6170915
      size: 4300
    outs:
    - path: brick/analysis-20130927/ctgov-studies-hlact.parquet
      hash: md5
      md5: 17220b5e6647a61294c6573c0d54ffd6
      size: 972272
  build-ctgov-studies-hlact-filtered@stanford_2019-2023:
    cmd:
    - make docker-compose-up
    - mkdir -p $(dirname brick/analysis-20240430/ctgov-studies-hlact.parquet)
    - . .env; script/tt-render-by-param stanford_2019-2023 sql/create_cthist_hlact.sql
      | duckdb
    deps:
    - path: brick/analysis-20240430/ctgov-studies-all.parquet
      hash: md5
      md5: 6da0dbb52abb77e9552b0a0085a9e93f
      size: 22499510
    - path: download/aact/db-dump/20240430_clinical_trials.zip
      hash: md5
      md5: dd7dd067786f58bbd6cd43758fc1a3da
      size: 1831128430
    - path: sql/create_cthist_hlact.sql
      hash: md5
      md5: a6a598b2d9b875dfd0abd5aae6170915
      size: 4300
    outs:
    - path: brick/analysis-20240430/ctgov-studies-hlact.parquet
      hash: md5
      md5: 9ad736575a824d04cd2d4984deff1b74
      size: 1656611
  build-ctgov-studies-all@sliding-window_n-1_20130901:
    cmd:
    - mkdir -p $(dirname brick/sliding-window/n-1_20130901/ctgov-studies-all.parquet)
    - script/tt-render-by-param sliding-window_n-1_20130901 sql/create_cthist_all.sql
      | duckdb
    deps:
    - path: download/ctgov/historical
      hash: md5
      md5: e040593bab918704633877b9b5c89197.dir
      size: 72594385446
      nfiles: 492953
    - path: sql/create_cthist_all.sql
      hash: md5
      md5: 8b2473c013948c766a2e1978c15ac12c
      size: 8314
    outs:
    - path: brick/sliding-window/n-1_20130901/ctgov-studies-all.parquet
      hash: md5
      md5: a8e91cf420d8e6392f9cce9bbca452d8
      size: 6176785
  build-ctgov-studies-all@sliding-window_n-2_20160101:
    cmd:
    - mkdir -p $(dirname brick/sliding-window/n-2_20160101/ctgov-studies-all.parquet)
    - script/tt-render-by-param sliding-window_n-2_20160101 sql/create_cthist_all.sql
      | duckdb
    deps:
    - path: download/ctgov/historical
      hash: md5
      md5: e040593bab918704633877b9b5c89197.dir
      size: 72594385446
      nfiles: 492953
    - path: sql/create_cthist_all.sql
      hash: md5
      md5: 8b2473c013948c766a2e1978c15ac12c
      size: 8314
    outs:
    - path: brick/sliding-window/n-2_20160101/ctgov-studies-all.parquet
      hash: md5
      md5: 391fe6fda8c97dae79e219a73ee7fe87
      size: 8555574
  build-ctgov-studies-all@sliding-window_n-3_20180501:
    cmd:
    - mkdir -p $(dirname brick/sliding-window/n-3_20180501/ctgov-studies-all.parquet)
    - script/tt-render-by-param sliding-window_n-3_20180501 sql/create_cthist_all.sql
      | duckdb
    deps:
    - path: download/ctgov/historical
      hash: md5
      md5: e040593bab918704633877b9b5c89197.dir
      size: 72594385446
      nfiles: 492953
    - path: sql/create_cthist_all.sql
      hash: md5
      md5: 8b2473c013948c766a2e1978c15ac12c
      size: 8314
    outs:
    - path: brick/sliding-window/n-3_20180501/ctgov-studies-all.parquet
      hash: md5
      md5: 83fae603e8d77c53ac2efb41932645dc
      size: 11964914
  build-ctgov-studies-all@sliding-window_n-4_20200901:
    cmd:
    - mkdir -p $(dirname brick/sliding-window/n-4_20200901/ctgov-studies-all.parquet)
    - script/tt-render-by-param sliding-window_n-4_20200901 sql/create_cthist_all.sql
      | duckdb
    deps:
    - path: download/ctgov/historical
      hash: md5
      md5: e040593bab918704633877b9b5c89197.dir
      size: 72594385446
      nfiles: 492953
    - path: sql/create_cthist_all.sql
      hash: md5
      md5: 8b2473c013948c766a2e1978c15ac12c
      size: 8314
    outs:
    - path: brick/sliding-window/n-4_20200901/ctgov-studies-all.parquet
      hash: md5
      md5: acbb3edbae8df089451c39c2313f6940
      size: 15737497
  build-ctgov-studies-all@sliding-window_n-5_20230101:
    cmd:
    - mkdir -p $(dirname brick/sliding-window/n-5_20230101/ctgov-studies-all.parquet)
    - script/tt-render-by-param sliding-window_n-5_20230101 sql/create_cthist_all.sql
      | duckdb
    deps:
    - path: download/ctgov/historical
      hash: md5
      md5: e040593bab918704633877b9b5c89197.dir
      size: 72594385446
      nfiles: 492953
    - path: sql/create_cthist_all.sql
      hash: md5
      md5: 8b2473c013948c766a2e1978c15ac12c
      size: 8314
    outs:
    - path: brick/sliding-window/n-5_20230101/ctgov-studies-all.parquet
      hash: md5
      md5: a485a87708c70e8115de29c0cbaa15f3
      size: 19957912
  build-ctgov-studies-hlact-filtered@sliding-window_n-1_20130901:
    cmd:
    - make docker-compose-up
    - mkdir -p $(dirname brick/sliding-window/n-1_20130901/ctgov-studies-hlact.parquet)
    - . .env; script/tt-render-by-param sliding-window_n-1_20130901 sql/create_cthist_hlact.sql
      | duckdb
    deps:
    - path: brick/sliding-window/n-1_20130901/ctgov-studies-all.parquet
      hash: md5
      md5: a8e91cf420d8e6392f9cce9bbca452d8
      size: 6176785
    - path: download/aact/db-dump/20240430_clinical_trials.zip
      hash: md5
      md5: dd7dd067786f58bbd6cd43758fc1a3da
      size: 1831128430
    - path: sql/create_cthist_hlact.sql
      hash: md5
      md5: a6a598b2d9b875dfd0abd5aae6170915
      size: 4300
    outs:
    - path: brick/sliding-window/n-1_20130901/ctgov-studies-hlact.parquet
      hash: md5
      md5: 30a6314cc3d5b5cf7b3fd1453d3e3051
      size: 967873
  build-ctgov-studies-hlact-filtered@sliding-window_n-2_20160101:
    cmd:
    - make docker-compose-up
    - mkdir -p $(dirname brick/sliding-window/n-2_20160101/ctgov-studies-hlact.parquet)
    - . .env; script/tt-render-by-param sliding-window_n-2_20160101 sql/create_cthist_hlact.sql
      | duckdb
    deps:
    - path: brick/sliding-window/n-2_20160101/ctgov-studies-all.parquet
      hash: md5
      md5: 391fe6fda8c97dae79e219a73ee7fe87
      size: 8555574
    - path: download/aact/db-dump/20240430_clinical_trials.zip
      hash: md5
      md5: dd7dd067786f58bbd6cd43758fc1a3da
      size: 1831128430
    - path: sql/create_cthist_hlact.sql
      hash: md5
      md5: a6a598b2d9b875dfd0abd5aae6170915
      size: 4300
    outs:
    - path: brick/sliding-window/n-2_20160101/ctgov-studies-hlact.parquet
      hash: md5
      md5: 51648612b7b5f25add4f477e581f37d4
      size: 1070492
  build-ctgov-studies-hlact-filtered@sliding-window_n-3_20180501:
    cmd:
    - make docker-compose-up
    - mkdir -p $(dirname brick/sliding-window/n-3_20180501/ctgov-studies-hlact.parquet)
    - . .env; script/tt-render-by-param sliding-window_n-3_20180501 sql/create_cthist_hlact.sql
      | duckdb
    deps:
    - path: brick/sliding-window/n-3_20180501/ctgov-studies-all.parquet
      hash: md5
      md5: 83fae603e8d77c53ac2efb41932645dc
      size: 11964914
    - path: download/aact/db-dump/20240430_clinical_trials.zip
      hash: md5
      md5: dd7dd067786f58bbd6cd43758fc1a3da
      size: 1831128430
    - path: sql/create_cthist_hlact.sql
      hash: md5
      md5: a6a598b2d9b875dfd0abd5aae6170915
      size: 4300
    outs:
    - path: brick/sliding-window/n-3_20180501/ctgov-studies-hlact.parquet
      hash: md5
      md5: d84178b22f834f17b17b374dd62f0ff0
      size: 1255837
  build-ctgov-studies-hlact-filtered@sliding-window_n-4_20200901:
    cmd:
    - make docker-compose-up
    - mkdir -p $(dirname brick/sliding-window/n-4_20200901/ctgov-studies-hlact.parquet)
    - . .env; script/tt-render-by-param sliding-window_n-4_20200901 sql/create_cthist_hlact.sql
      | duckdb
    deps:
    - path: brick/sliding-window/n-4_20200901/ctgov-studies-all.parquet
      hash: md5
      md5: acbb3edbae8df089451c39c2313f6940
      size: 15737497
    - path: download/aact/db-dump/20240430_clinical_trials.zip
      hash: md5
      md5: dd7dd067786f58bbd6cd43758fc1a3da
      size: 1831128430
    - path: sql/create_cthist_hlact.sql
      hash: md5
      md5: a6a598b2d9b875dfd0abd5aae6170915
      size: 4300
    outs:
    - path: brick/sliding-window/n-4_20200901/ctgov-studies-hlact.parquet
      hash: md5
      md5: 0b2ec61118a83c1d32b93fad71a9b438
      size: 1515895
  build-ctgov-studies-hlact-filtered@sliding-window_n-5_20230101:
    cmd:
    - make docker-compose-up
    - mkdir -p $(dirname brick/sliding-window/n-5_20230101/ctgov-studies-hlact.parquet)
    - . .env; script/tt-render-by-param sliding-window_n-5_20230101 sql/create_cthist_hlact.sql
      | duckdb
    deps:
    - path: brick/sliding-window/n-5_20230101/ctgov-studies-all.parquet
      hash: md5
      md5: a485a87708c70e8115de29c0cbaa15f3
      size: 19957912
    - path: download/aact/db-dump/20240430_clinical_trials.zip
      hash: md5
      md5: dd7dd067786f58bbd6cd43758fc1a3da
      size: 1831128430
    - path: sql/create_cthist_hlact.sql
      hash: md5
      md5: a6a598b2d9b875dfd0abd5aae6170915
      size: 4300
    outs:
    - path: brick/sliding-window/n-5_20230101/ctgov-studies-hlact.parquet
      hash: md5
      md5: 0d75a6dc965bb2fe42b4d0ad328e6c7c
      size: 1717234
