schema: '2.0'
stages:
  download-20170105:
    cmd: stages/01_download_db_20170105.sh
    deps:
    - path: stages/01_download_db_20170105.sh
      hash: md5
      md5: 6369e51a35200af74e8359122d1afa11
      size: 500
    outs:
    - path: download/aact/db-dump/20170105_clinical_trials.zip
      hash: md5
      md5: 54550221d6d2f728b5df64ea40078b2b
      size: 639987071
  download-20240430:
    cmd: stages/01_download_db_20240430.sh
    deps:
    - path: stages/01_download_db_20240430.sh
      hash: md5
      md5: 0f380d067cb2eeab31c97253811e9fb5
      size: 412
    outs:
    - path: download/aact/db-dump/20240430_clinical_trials.zip
      hash: md5
      md5: dd7dd067786f58bbd6cd43758fc1a3da
      size: 1831128430
  download-paper-data:
    cmd: stages/01_download_paper_data.sh
    deps:
    - path: stages/01_download_paper_data.sh
      hash: md5
      md5: 9cbfcb140a15b9b54101639dff6653e0
      size: 524
    outs:
    - path: download/anderson2015
      hash: md5
      md5: 0f627e15c08e5ec23c2eabe0ad574d25.dir
      size: 4199399
      nfiles: 2
  build-paper-data:
    cmd: stages/02_build-anderson2015.sh
    deps:
    - path: download/anderson2015
      hash: md5
      md5: 0f627e15c08e5ec23c2eabe0ad574d25.dir
      size: 4199399
      nfiles: 2
    - path: stages/02_build-anderson2015.sh
      hash: md5
      md5: 0942894b0d5b0d180db7a7deecc38f64
      size: 464
    - path: stages/csv2parquet.py
      hash: md5
      md5: 7ad66f7287f06705bbbd11fd0791ad63
      size: 1260
    outs:
    - path: brick/anderson2015
      hash: md5
      md5: 1395cc31b50eca34bf0a57f5a4ed9d0f.dir
      size: 1387361
      nfiles: 4
  download-cthist-json:
    cmd: stages/01_download_cthist_json.sh
    deps:
    - path: brick/anderson2015
      hash: md5
      md5: 1395cc31b50eca34bf0a57f5a4ed9d0f.dir
      size: 1387361
      nfiles: 4
    - path: download/aact/db-dump/20240430_clinical_trials.zip
      hash: md5
      md5: dd7dd067786f58bbd6cd43758fc1a3da
      size: 1831128430
    - path: stages/01_download_cthist_json.sh
      hash: md5
      md5: 77aad131be4444d3d01bccb4527bb04b
      size: 952
    - path: stages/fetch-cthist-json.pl
      hash: md5
      md5: e9cc9af2851ee15b912f6658d4d38752
      size: 12768
    outs:
    - path: download/ctgov/historical
      hash: md5
      md5: e040593bab918704633877b9b5c89197.dir
      size: 72594385446
      nfiles: 492953
  build-ctgov-studies-all@anderson2015_2008-2012:
    cmd:
    - mkdir -p $(dirname brick/analysis-20130927/ctgov-studies-all.parquet)
    - script/tt-render-by-param anderson2015_2008-2012 sql/create_cthist_all.sql |
      duckdb
    deps:
    - path: download/ctgov/historical
      hash: md5
      md5: c920d855e9b65a50f913295329fc9cbb.dir
      size: 9443877912
      nfiles: 492953
    - path: sql/create_cthist_all.sql
      hash: md5
      md5: 8b2473c013948c766a2e1978c15ac12c
      size: 8314
    outs:
    - path: brick/analysis-20130927/ctgov-studies-all.parquet
      hash: md5
      md5: dc31b4ab8fe6232c4acd797c37103ede
      size: 6294632
  build-ctgov-studies-all@stanford_2019-2023:
    cmd:
    - mkdir -p $(dirname brick/analysis-20240430/ctgov-studies-all.parquet)
    - script/tt-render-by-param stanford_2019-2023 sql/create_cthist_all.sql | duckdb
    deps:
    - path: download/ctgov/historical
      hash: md5
      md5: c920d855e9b65a50f913295329fc9cbb.dir
      size: 9443877912
      nfiles: 492953
    - path: sql/create_cthist_all.sql
      hash: md5
      md5: 8b2473c013948c766a2e1978c15ac12c
      size: 8314
    outs:
    - path: brick/analysis-20240430/ctgov-studies-all.parquet
      hash: md5
      md5: 6231edc74719d7b5063c47e766b674fe
      size: 22641141
  build-ctgov-studies-hlact-filtered@anderson2015_2008-2012:
    cmd:
    - make docker-compose-up
    - mkdir -p $(dirname brick/analysis-20130927/ctgov-studies-hlact.parquet)
    - . .env; script/tt-render-by-param anderson2015_2008-2012 sql/create_cthist_hlact.sql
      | duckdb
    deps:
    - path: brick/analysis-20130927/ctgov-studies-all.parquet
      hash: md5
      md5: dc31b4ab8fe6232c4acd797c37103ede
      size: 6294632
    - path: download/aact/db-dump/20240430_clinical_trials.zip
      hash: md5
      md5: dd7dd067786f58bbd6cd43758fc1a3da
      size: 1831128430
    - path: sql/create_cthist_hlact.sql
      hash: md5
      md5: a6a598b2d9b875dfd0abd5aae6170915
      size: 4300
    outs:
    - path: brick/analysis-20130927/ctgov-studies-hlact.parquet
      hash: md5
      md5: c5ee02ab0f1cc8b0db0547e96f627c0f
      size: 1005001
  build-ctgov-studies-hlact-filtered@stanford_2019-2023:
    cmd:
    - make docker-compose-up
    - mkdir -p $(dirname brick/analysis-20240430/ctgov-studies-hlact.parquet)
    - . .env; script/tt-render-by-param stanford_2019-2023 sql/create_cthist_hlact.sql
      | duckdb
    deps:
    - path: brick/analysis-20240430/ctgov-studies-all.parquet
      hash: md5
      md5: 6231edc74719d7b5063c47e766b674fe
      size: 22641141
    - path: download/aact/db-dump/20240430_clinical_trials.zip
      hash: md5
      md5: dd7dd067786f58bbd6cd43758fc1a3da
      size: 1831128430
    - path: sql/create_cthist_hlact.sql
      hash: md5
      md5: a6a598b2d9b875dfd0abd5aae6170915
      size: 4300
    outs:
    - path: brick/analysis-20240430/ctgov-studies-hlact.parquet
      hash: md5
      md5: 2cdf77dd7853e1e0ffa1f616c3d65084
      size: 1682608
  build-ctgov-studies-all@sliding-window_n-1_20130901:
    cmd:
    - mkdir -p $(dirname brick/sliding-window_n-1_20130901/ctgov-studies-all.parquet)
    - script/tt-render-by-param sliding-window_n-1_20130901 sql/create_cthist_all.sql
      | duckdb
    deps:
    - path: download/ctgov/historical
      hash: md5
      md5: c920d855e9b65a50f913295329fc9cbb.dir
      size: 9443877912
      nfiles: 492953
    - path: sql/create_cthist_all.sql
      hash: md5
      md5: 8b2473c013948c766a2e1978c15ac12c
      size: 8314
    outs:
    - path: brick/sliding-window_n-1_20130901/ctgov-studies-all.parquet
      hash: md5
      md5: 2927720ea69f28b7747e0086854713f7
      size: 5862510
  build-ctgov-studies-all@sliding-window_n-2_20160101:
    cmd:
    - mkdir -p $(dirname brick/sliding-window_n-2_20160101/ctgov-studies-all.parquet)
    - script/tt-render-by-param sliding-window_n-2_20160101 sql/create_cthist_all.sql
      | duckdb
    deps:
    - path: download/ctgov/historical
      hash: md5
      md5: c920d855e9b65a50f913295329fc9cbb.dir
      size: 9443877912
      nfiles: 492953
    - path: sql/create_cthist_all.sql
      hash: md5
      md5: 8b2473c013948c766a2e1978c15ac12c
      size: 8314
    outs:
    - path: brick/sliding-window_n-2_20160101/ctgov-studies-all.parquet
      hash: md5
      md5: 72532c812d3f8f4b41ec76bf7d596243
      size: 6991837
  build-ctgov-studies-all@sliding-window_n-3_20180501:
    cmd:
    - mkdir -p $(dirname brick/sliding-window_n-3_20180501/ctgov-studies-all.parquet)
    - script/tt-render-by-param sliding-window_n-3_20180501 sql/create_cthist_all.sql
      | duckdb
    deps:
    - path: download/ctgov/historical
      hash: md5
      md5: c920d855e9b65a50f913295329fc9cbb.dir
      size: 9443877912
      nfiles: 492953
    - path: sql/create_cthist_all.sql
      hash: md5
      md5: 8b2473c013948c766a2e1978c15ac12c
      size: 8314
    outs:
    - path: brick/sliding-window_n-3_20180501/ctgov-studies-all.parquet
      hash: md5
      md5: 83df1f67244803950ea72f553ff80630
      size: 8812346
  build-ctgov-studies-all@sliding-window_n-4_20200901:
    cmd:
    - mkdir -p $(dirname brick/sliding-window_n-4_20200901/ctgov-studies-all.parquet)
    - script/tt-render-by-param sliding-window_n-4_20200901 sql/create_cthist_all.sql
      | duckdb
    deps:
    - path: download/ctgov/historical
      hash: md5
      md5: c920d855e9b65a50f913295329fc9cbb.dir
      size: 9443877912
      nfiles: 492953
    - path: sql/create_cthist_all.sql
      hash: md5
      md5: 8b2473c013948c766a2e1978c15ac12c
      size: 8314
    outs:
    - path: brick/sliding-window_n-4_20200901/ctgov-studies-all.parquet
      hash: md5
      md5: 3c5781874c504ec74ba0f84d64d2d03e
      size: 11817543
  build-ctgov-studies-all@sliding-window_n-5_20230101:
    cmd:
    - mkdir -p $(dirname brick/sliding-window_n-5_20230101/ctgov-studies-all.parquet)
    - script/tt-render-by-param sliding-window_n-5_20230101 sql/create_cthist_all.sql
      | duckdb
    deps:
    - path: download/ctgov/historical
      hash: md5
      md5: c920d855e9b65a50f913295329fc9cbb.dir
      size: 9443877912
      nfiles: 492953
    - path: sql/create_cthist_all.sql
      hash: md5
      md5: 8b2473c013948c766a2e1978c15ac12c
      size: 8314
    outs:
    - path: brick/sliding-window_n-5_20230101/ctgov-studies-all.parquet
      hash: md5
      md5: bd57b85160acde7e5e5d18c7950fbf36
      size: 15995349
  build-ctgov-studies-hlact-filtered@sliding-window_n-1_20130901:
    cmd:
    - make docker-compose-up
    - mkdir -p $(dirname brick/sliding-window_n-1_20130901/ctgov-studies-hlact.parquet)
    - . .env; script/tt-render-by-param sliding-window_n-1_20130901 sql/create_cthist_hlact.sql
      | duckdb
    deps:
    - path: brick/sliding-window_n-1_20130901/ctgov-studies-all.parquet
      hash: md5
      md5: 2927720ea69f28b7747e0086854713f7
      size: 5862510
    - path: download/aact/db-dump/20240430_clinical_trials.zip
      hash: md5
      md5: dd7dd067786f58bbd6cd43758fc1a3da
      size: 1831128430
    - path: sql/create_cthist_hlact.sql
      hash: md5
      md5: a6a598b2d9b875dfd0abd5aae6170915
      size: 4300
    outs:
    - path: brick/sliding-window_n-1_20130901/ctgov-studies-hlact.parquet
      hash: md5
      md5: b7a9d1d9905c4d62f7fc4a3579d7a140
      size: 971518
  build-ctgov-studies-hlact-filtered@sliding-window_n-2_20160101:
    cmd:
    - make docker-compose-up
    - mkdir -p $(dirname brick/sliding-window_n-2_20160101/ctgov-studies-hlact.parquet)
    - . .env; script/tt-render-by-param sliding-window_n-2_20160101 sql/create_cthist_hlact.sql
      | duckdb
    deps:
    - path: brick/sliding-window_n-2_20160101/ctgov-studies-all.parquet
      hash: md5
      md5: 72532c812d3f8f4b41ec76bf7d596243
      size: 6991837
    - path: download/aact/db-dump/20240430_clinical_trials.zip
      hash: md5
      md5: dd7dd067786f58bbd6cd43758fc1a3da
      size: 1831128430
    - path: sql/create_cthist_hlact.sql
      hash: md5
      md5: a6a598b2d9b875dfd0abd5aae6170915
      size: 4300
    outs:
    - path: brick/sliding-window_n-2_20160101/ctgov-studies-hlact.parquet
      hash: md5
      md5: a62c3bf4497e8e675eb93e05c617970e
      size: 870543
  build-ctgov-studies-hlact-filtered@sliding-window_n-3_20180501:
    cmd:
    - make docker-compose-up
    - mkdir -p $(dirname brick/sliding-window_n-3_20180501/ctgov-studies-hlact.parquet)
    - . .env; script/tt-render-by-param sliding-window_n-3_20180501 sql/create_cthist_hlact.sql
      | duckdb
    deps:
    - path: brick/sliding-window_n-3_20180501/ctgov-studies-all.parquet
      hash: md5
      md5: 83df1f67244803950ea72f553ff80630
      size: 8812346
    - path: download/aact/db-dump/20240430_clinical_trials.zip
      hash: md5
      md5: dd7dd067786f58bbd6cd43758fc1a3da
      size: 1831128430
    - path: sql/create_cthist_hlact.sql
      hash: md5
      md5: a6a598b2d9b875dfd0abd5aae6170915
      size: 4300
    outs:
    - path: brick/sliding-window_n-3_20180501/ctgov-studies-hlact.parquet
      hash: md5
      md5: 40c3bb22f763c6a580af2f3e71c9fbf4
      size: 915643
  build-ctgov-studies-hlact-filtered@sliding-window_n-4_20200901:
    cmd:
    - make docker-compose-up
    - mkdir -p $(dirname brick/sliding-window_n-4_20200901/ctgov-studies-hlact.parquet)
    - . .env; script/tt-render-by-param sliding-window_n-4_20200901 sql/create_cthist_hlact.sql
      | duckdb
    deps:
    - path: brick/sliding-window_n-4_20200901/ctgov-studies-all.parquet
      hash: md5
      md5: 3c5781874c504ec74ba0f84d64d2d03e
      size: 11817543
    - path: download/aact/db-dump/20240430_clinical_trials.zip
      hash: md5
      md5: dd7dd067786f58bbd6cd43758fc1a3da
      size: 1831128430
    - path: sql/create_cthist_hlact.sql
      hash: md5
      md5: a6a598b2d9b875dfd0abd5aae6170915
      size: 4300
    outs:
    - path: brick/sliding-window_n-4_20200901/ctgov-studies-hlact.parquet
      hash: md5
      md5: 4eb576e5f5cd7f504682fb31a9e9cf4c
      size: 1227974
  build-ctgov-studies-hlact-filtered@sliding-window_n-5_20230101:
    cmd:
    - make docker-compose-up
    - mkdir -p $(dirname brick/sliding-window_n-5_20230101/ctgov-studies-hlact.parquet)
    - . .env; script/tt-render-by-param sliding-window_n-5_20230101 sql/create_cthist_hlact.sql
      | duckdb
    deps:
    - path: brick/sliding-window_n-5_20230101/ctgov-studies-all.parquet
      hash: md5
      md5: bd57b85160acde7e5e5d18c7950fbf36
      size: 15995349
    - path: download/aact/db-dump/20240430_clinical_trials.zip
      hash: md5
      md5: dd7dd067786f58bbd6cd43758fc1a3da
      size: 1831128430
    - path: sql/create_cthist_hlact.sql
      hash: md5
      md5: a6a598b2d9b875dfd0abd5aae6170915
      size: 4300
    outs:
    - path: brick/sliding-window_n-5_20230101/ctgov-studies-hlact.parquet
      hash: md5
      md5: 097d2ddec4d7af6d6d8d1bdd769f5643
      size: 1541536
